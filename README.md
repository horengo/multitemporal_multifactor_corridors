# Repository for the generation of multitemporal multifactor corridor networks (M2CoNet)
The generation of M2CoNet requires several steps:
1. Generation of cost surface.
2. Generation of cost distance rasters from user-defined points using the knights move algorithm.
3. Generation of corridors using the previously generated cost distance rasters.
4. Normalisation of the corridors.
5. Raster cells stats to join all normalised corridors.

While a Jupyter Notebook with the full algorithm is provided (the requirements file can be used to set up the environment), GEE code is also provided for those who prefer to use GEE web-based code editor.
Just copy the GEE code, paste it into the code editor and press run.

## Setting up the environment

Create and activate an env using the provided YAML file: <br> <br>
```conda env create -f environment_m2conet.yml  # Creates the environemt and installs the pinned packages <br>
*conda activate m2conet*  # Activates the environment <br>
*python -m ipykernel install --user --name m2conet --display-name "m2conet"*  # Optional: registers your current Python environment as a selectable Jupyter kernel. No need to use if you are going to lauch Jupyter from m3conet environment (the YAML file installs jupyterlab) <br>
```

**Alternatively** if you prefer to use the requirements pip file instead of conda pins, install only the heavy libs with conda, then pip the pinned set (helps when pip wheels struggle with GDAL/PROJ). <br> <br>
*conda create -n m2conet -c conda-forge python=3.10 -y*  # Creates the environemt (with a supported Python 3.10, which is safe for NumPy 1.26.x) and installs the pinned packages <br>
*conda activate m2conet*  # Activates the environemt <br>
*conda install -c conda-forge python=3.10 rasterio gdal -y*  # Installs the pinned packages <br>
*pip install -r /mnt/data/requirements_M2CoNet.txt*  <br>
*python -m ipykernel install --user --name m2conet --display-name "m2conet"*  # Register the kernel in Jupyter (optional, see above) <br>


## For the generation of cost surfaces
The generation of cost surfaces requires two external datasets:
1. Maps of areas with loose sand surfaces (i.e. deserts). This was not generated by the same code as it requires a Mchine Learning multi-sensor approach that would have been too heavy for a single script.
   Consequently, the GEE code calls the resulting map from my GEE asset repository. The GEE code for the generation of this map has also been provided for reproducibility reasons but it is not required to
   run the GEE code for the generation of cost surfaces.
3. The Global Reservoir and Dam Database (GRanD), whcih can be downloaded at https://www.globaldamwatch.org/directory <br>
   Please, note that the GRanD has now been superseded by the The GDW (v1) consensus global database. <br>
   In order to use the database, please, download it from the provided link and upload in your GEE assets repository. Then substitute the name of the asset in code (line 99 in the GEE code provided).

## For the generation of corridors
GRASS GIS needs to be installed locally.<br>
Follow the instruction provided within the Jupyter notebook.
