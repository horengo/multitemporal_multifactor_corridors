# Repository for the generation of multitemporal multifactor corridor networks (M2CoNet)
The generation of M2CoNet requires several steps:
1. Generation of cost surface.
2. Generation of cost distance rasters from user-defined points using the knights move algorithm.
3. Generation of corridors using the previously generated cost distance rasters.
4. Normalisation of the corridors.
5. Raster cells stats to join all normalised corridors.

While a Jupyter Notebook with the full algorithm is provided (the requirements file can be used to set up the environment), GEE code is also provided for those who prefer to use GEE web-based code editor.
Just copy the GEE code, paste it into the code editor and press run.

## Setting up the environment

1. Create and activate an env (pick a supported Python; 3.10 is safe for NumPy 1.26.x):
*conda env create -f environment_m2conet.yml* # Creates the environemt and installs the pinned packages
conda activate m2conet
python -m ipykernel install --user --name m2conet --display-name "m2conet"* Registers your current Python environment as a selectable Jupyter kernel

2. Install everything via conda where possible (pins optional but recommended)
*conda install -c conda-forge \
  numpy==1.26.2 rasterio==1.3.9 gdal geemap==0.36.6 earthengine-api==1.6.15 \
  google-auth==2.41.1 google-auth-oauthlib==1.2.3 google-cloud-storage==3.4.1 \
  ipykernel==6.25.0 ipython==8.15.0 ipywidgets==8.0.4 jupyterlab==4.4.10 -y*

2alt. **Alternatively** if you prefer to follow the exact pip file instead of conda pins, install only the heavy libs with conda, then pip the pinned set (helps when pip wheels struggle with GDAL/PROJ).
*conda install -c conda-forge python=3.10 rasterio gdal -y
pip install -r /mnt/data/requirements_M2CoNet.txt*

3. Register the kernel in Jupyter
python -m ipykernel install --user --name m2conet --display-name "m2conet"


## For the generation of cost surfaces
The generation of cost surfaces requires two external datasets:
1. Maps of areas with loose sand surfaces (i.e. deserts). This was not generated by the same code as it requires a Mchine Learning multi-sensor approach that would have been too heavy for a single script.
   Consequently, the GEE code calls the resulting map from my GEE asset repository. The GEE code for the generation of this map has also been provided for reproducibility reasons but it is not required to
   run the GEE code for the generation of cost surfaces.
3. The Global Reservoir and Dam Database (GRanD), whcih can be downloaded at https://www.globaldamwatch.org/directory <br>
   Please, note that the GRanD has now been superseded by the The GDW (v1) consensus global database. <br>
   In order to use the database, please, download it from the provided link and upload in your GEE assets repository. Then substitute the name of the asset in code (line 99 in the GEE code provided).

## For the generation of corridors
GRASS GIS needs to be installed locally.<br>
Follow the instruction provided within the Jupyter notebook.
